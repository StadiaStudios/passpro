<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PassPro</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.png">
    
    <!-- PWA meta tags and manifest file -->
    <meta name="theme-color" content="#111"/>
    <link rel="apple-touch-icon" href="assets/favicon.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- Font Awesome for hamburger icon and eye icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease;
        }
        body.dark-mode {
            background-color: #111;
        }
        body.light-mode {
            background-color: #f0f0f0;
        }
        .nav-link, .link-effect, .password-url-link {
            position: relative;
            display: inline-block;
            padding-bottom: 4px;
            transition: all 0.3s ease-in-out;
        }
        .nav-link::after, .link-effect::after, .password-url-link::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 0;
            height: 2px;
            background-color: orange;
            transition: width 0.3s ease-in-out;
        }
        .light-mode .nav-link::after, .light-mode .link-effect::after, .light-mode .password-url-link::after {
            background-color: orange;
        }
        .nav-link:hover::after, .nav-link.active::after, .link-effect:hover::after, .link-effect.active::after, .password-url-link:hover::after, .password-url-link.active::after {
            width: 100%;
        }
        .forgot-pin-link {
            position: relative;
            display: inline-block;
            padding-bottom: 2px;
            transition: all 0.3s ease-in-out;
            color: #ccc;
        }
        .light-mode .forgot-pin-link {
            color: #444;
        }
        .forgot-pin-link::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 0;
            height: 2px;
            background-color: orange;
            transition: width 0.3s ease-in-out;
        }
        .forgot-pin-link:hover::after {
            width: 100%;
        }
        .dark-mode .text-secondary {
            color: #ccc;
        }
        .light-mode .text-secondary {
            color: #444;
        }
        .dark-mode .input-field {
            background-color: #1A1A1A;
            border-color: #4A4A4A;
            color: white;
        }
        .light-mode .input-field {
            background-color: #f5f5f5;
            border-color: #ddd;
            color: #1a1a1a;
        }
        .terms-link {
            position: relative;
            display: inline-block;
            padding-bottom: 2px;
            transition: all 0.3s ease-in-out;
            color: white; 
        }
        .light-mode .terms-link {
            color: black;
        }
        .terms-link::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 0;
            height: 2px;
            background-color: orange;
            transition: width 0.3s ease-in-out;
        }
        .terms-link:hover::after {
            width: 100%;
        }
        .password-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        .password-item.drag-over {
            border: 2px solid orange;
            box-shadow: 0 0 8px orange;
        }
        /* Custom scrollbar styles */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2a2a2a;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #666;
        }

        .custom-file-input::-webkit-file-upload-button {
            visibility: hidden;
        }
        .custom-file-input::before {
            content: 'Choose File';
            display: inline-block;
            background: #333;
            border: 1px solid #555;
            border-radius: 4px;
            padding: 8px 12px;
            outline: none;
            white-space: nowrap;
            cursor: pointer;
            font-weight: 500;
            text-shadow: 1px 1px #000;
            font-size: 10pt;
        }
        .custom-file-input:hover::before {
            border-color: black;
        }
        .custom-file-input:active::before {
            background: -webkit-linear-gradient(top, #e3e3e3, #f5f5f5);
        }
        /* Toggle Switch Styles */
        #pin-lock-toggle:checked ~ .block {
            background-color: #FFA500; /* Orange background when checked */
        }
        #pin-lock-toggle:checked ~ .dot {
            transform: translateX(100%);
        }

        /* Mobile Nav Specific Styles */
        .mobile-nav-menu {
            transition: transform 0.3s ease-in-out;
            transform: translateX(100%);
        }
        .mobile-nav-menu.open {
            transform: translateX(0);
        }

        /* Fullscreen Settings Page overrides */
        #user-profile-section.page-section > div {
            background-color: transparent !important;
            box-shadow: none !important;
        }
    </style>
</head>
<body class="dark-mode min-h-screen flex flex-col items-center">

    <!-- Custom Modal for Messages -->
    <div id="modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-50">
        <div class="bg-[#2A2A2A] p-6 rounded-lg shadow-xl max-w-sm w-full mx-4 text-center text-white">
            <h3 id="modal-title" class="text-xl font-bold mb-2"></h3>
            <p id="modal-message" class="text-gray-300 mb-4"></p>
            <div id="modal-buttons" class="flex justify-center space-x-4">
                <button id="modal-ok-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">OK</button>
                <button id="modal-cancel-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">Cancel</button>
            </div>
        </div>
    </div>

    <!-- PIN Modal -->
    <div id="pin-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-75">
        <div class="bg-[#1A1A1A] p-8 rounded-lg shadow-xl max-w-md w-full mx-4 text-center text-white">
            <h2 id="pin-modal-title" class="text-2xl font-bold mb-4"></h2>
            <input type="password" id="pin-input" placeholder="••••" class="w-full text-center bg-[#2A2A2A] text-white rounded-lg p-3 mb-4 focus:outline-none focus:ring-2 focus:ring-orange-500">
            <!-- Incorrect PIN message element -->
            <p id="pin-error-message" class="text-red-500 text-sm mt-2 mb-4 hidden">Incorrect PIN. Please try again.</p>
            <button id="pin-submit-btn" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-200">Unlock</button>
            <p class="mt-4 text-sm text-gray-400">
                <a href="help/forgot-pin.html" id="forgot-pin-link" class="forgot-pin-link hover:text-orange-400">Forgot PIN?</a>
            </p>
        </div>
    </div>

    <!-- Header Navigation -->
    <header class="w-full bg-transparent p-4 flex justify-between items-center text-white">
        <div class="flex items-center space-x-2">
            <img src="assets/favicon.png" alt="PassPro Logo" class="h-8 w-8">
            <h1 class="text-xl font-bold text-white">PassPro</h1>
        </div>
        <nav class="hidden md:flex items-center space-x-4">
            <span id="welcome-message" class="text-secondary text-sm hidden md:block"></span>
            <a href="#" class="nav-link" data-page="dashboard-section">Dashboard</a>
            <a href="#" class="nav-link" data-page="password-list-section">Passwords</a>
            <a href="#" class="nav-link" data-page="user-profile-section">Settings</a>
        </nav>
        
        <!-- Mobile Hamburger Menu Icon -->
        <button id="hamburger-btn" class="text-white md:hidden focus:outline-none">
            <i class="fas fa-bars text-2xl"></i>
        </button>
    </header>

    <!-- Mobile Navigation Menu -->
    <div id="mobile-nav-menu" class="fixed top-0 right-0 h-full w-2/3 bg-[#1A1A1A] text-white shadow-xl z-40 mobile-nav-menu p-6 md:hidden">
        <div class="flex justify-end mb-6">
            <button id="close-mobile-nav" class="text-white focus:outline-none">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        <nav class="flex flex-col space-y-4 text-xl">
            <a href="#" class="nav-link block" data-page="dashboard-section">Dashboard</a>
            <a href="#" class="nav-link block" data-page="password-list-section">Passwords</a>
            <a href="#" class="nav-link block" data-page="user-profile-section">Settings</a>
        </nav>
        <div class="absolute bottom-6 left-6 w-full pr-12">
            <span id="mobile-welcome-message" class="text-secondary text-sm"></span>
        </div>
    </div>

    <main class="flex-grow w-full p-4 md:p-8">

        <!-- Dashboard Section -->
        <section id="dashboard-section" class="page-section hidden max-w-4xl mx-auto">
            <div class="p-6 bg-[#1A1A1A] rounded-lg shadow-xl text-white">
                <h2 class="text-3xl font-bold mb-4">Welcome to PassPro!</h2>
                <p class="text-lg text-secondary">Your secure and customizable password manager.</p>
                <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-6 bg-[#2A2A2A] rounded-lg">
                        <h3 class="text-xl font-semibold mb-2 text-orange-500">Quick Actions</h3>
                        <ul class="space-y-2 text-secondary">
                            <li><button class="text-white-800 hover:text-orange-500 transition-colors duration-200 link-effect" id="go-to-add-password">Add a new password</button></li>
                            <li><button class="text-white-80 hover:text-orange-500 transition-colors duration-200 link-effect" id="go-to-passwords">View all passwords</button></li>
                            <li><button class="text-white-80 hover:text-orange-500 transition-colors duration-200 link-effect" id="lock-app-btn">Lock App</button></li>
                        </ul>
                    </div>
                    <div class="p-6 bg-[#2A2A2A] rounded-lg">
                        <h3 class="text-xl font-semibold mb-2 text-orange-500">Local Data</h3>
                        <p class="text-secondary">Total Passwords: <span id="total-passwords">0</span></p>
                        <p class="text-secondary">Last Sync: <span id="last-sync">N/A</span></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Password List Section -->
        <section id="password-list-section" class="page-section hidden w-full h-full p-0">
            <div class="p-6 md:p-8 text-white w-full h-full flex flex-col">
                <h2 class="text-3xl font-bold mb-6">My Passwords</h2>
                <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mb-6">
                    <input type="text" id="search-input" placeholder="Search passwords..." class="input-field flex-grow p-3 rounded-lg">
                    <button id="add-password-btn" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200">
                        <i class="fas fa-plus-circle mr-2"></i> Add Password
                    </button>
                    <button id="arrange-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200">
                        Arrange
                    </button>
                </div>
                <div id="password-list" class="flex-grow grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 overflow-y-auto">
                    <!-- Password items will be injected here -->
                </div>
            </div>
        </section>

        <!-- User Profile Section -->
        <section id="user-profile-section" class="page-section hidden max-w-4xl mx-auto">
            <div class="p-6 text-white w-full h-full flex flex-col items-center">
                <h2 class="text-3xl font-bold mb-6 text-center">Settings</h2>
                <div class="w-full max-w-2xl mx-auto space-y-8 flex-grow">
                    
                    <div class="bg-[#1A1A1A] p-6 rounded-lg shadow-xl">
                        <h3 class="text-xl font-semibold mb-4 text-orange-500">User Settings</h3>
                        <div>
                            <label for="username-input" class="block text-sm font-medium text-secondary mb-1">Username</label>
                            <input type="text" id="username-input" class="input-field w-full p-3 rounded-lg" placeholder="Enter your username">
                        </div>
                    </div>
                    
                    <div class="bg-[#1A1A1A] p-6 rounded-lg shadow-xl">
                        <h3 class="text-xl font-semibold mb-4 text-orange-500">Security Settings</h3>
                        <div class="flex items-center justify-between">
                            <label for="pin-lock-toggle" class="flex items-center cursor-pointer">
                                <div class="relative">
                                    <input type="checkbox" id="pin-lock-toggle" class="sr-only">
                                    <div class="block bg-gray-600 w-14 h-8 rounded-full"></div>
                                    <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform transform"></div>
                                </div>
                                <span class="ml-3 font-medium text-gray-300">Enable PIN Lock</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="bg-[#1A1A1A] p-6 rounded-lg shadow-xl">
                        <h3 class="text-xl font-semibold mb-4 text-orange-500">Data Management</h3>
                        <div class="space-y-4">
                            <button id="download-account-btn" class="w-full bg-[#222] hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200">
                                Download Account
                            </button>
                            <div class="relative">
                                <button id="import-account-btn" class="w-full bg-[#222] hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200">
                                    Import Account
                                </button>
                                <input type="file" id="import-file-input" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                            </div>
                        </div>
                    </div>

                    <div class="bg-[#1A1A1A] p-6 rounded-lg shadow-xl">
                        <h3 class="text-xl font-semibold mb-4 text-orange-500">Local Storage</h3>
                        <p class="text-secondary mb-4">Storage Used: <span id="storage-size">0 KB</span></p>
                        <button id="clear-cache-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-200">
                            Clear All Data
                        </button>
                    </div>

                </div>
                <!-- App Version Display -->
                <div class="text-center mt-8 text-sm text-gray-500 flex flex-col items-center">
                    <p>App Version: <span id="app-version">1.3.3</span></p>
                    <a href="terms_of_service.html" id="terms-link" class="terms-link mt-2 text-white">Terms and Conditions</a>
                </div>
            </div>
        </section>
        
        <!-- Add/Edit Password Modal -->
        <div id="password-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-75 p-4">
            <div class="bg-[#1A1A1A] p-6 rounded-lg shadow-xl max-w-lg w-full text-white">
                <h2 id="password-modal-title" class="text-2xl font-bold mb-4">Add Password</h2>
                <form id="password-form" class="space-y-4">
                    <div>
                        <label for="password-title" class="block text-sm font-medium text-secondary mb-1">Title</label>
                        <input type="text" id="password-title" class="input-field w-full p-3 rounded-lg" required>
                    </div>
                    <div>
                        <label for="password-username" class="block text-sm font-medium text-secondary mb-1">Username</label>
                        <input type="text" id="password-username" class="input-field w-full p-3 rounded-lg" required>
                    </div>
                    <div>
                        <label for="password-password" class="block text-sm font-medium text-secondary mb-1">Password</label>
                        <input type="password" id="password-password" class="input-field w-full p-3 rounded-lg" required>
                    </div>
                    <div>
                        <label for="password-url" class="block text-sm font-medium text-secondary mb-1">URL (optional)</label>
                        <input type="url" id="password-url" class="input-field w-full p-3 rounded-lg">
                    </div>
                    <div>
                        <label for="password-notes" class="block text-sm font-medium text-secondary mb-1">Notes (optional)</label>
                        <textarea id="password-notes" rows="4" class="input-field w-full p-3 rounded-lg"></textarea>
                    </div>
                    <div class="flex justify-end space-x-4">
                        <button type="button" id="password-modal-cancel" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">Cancel</button>
                        <button type="submit" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">Save</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Profile Details Modal -->
        <div id="profile-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-75 p-4">
            <div class="bg-[#1A1A1A] p-6 rounded-lg shadow-xl max-w-md w-full text-white">
                <h2 id="profile-title" class="text-2xl font-bold mb-4"></h2>
                <div id="profile-details-content" class="text-secondary text-base space-y-2">
                    <!-- Details will be injected here -->
                </div>
                <div class="mt-4 flex justify-end">
                    <button id="profile-modal-close" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200">Close</button>
                </div>
            </div>
        </div>

    </main>
    
    <script>
        // Global variables for data
        let passwords = [];
        let arrangeMode = false;
        let isEditing = false;
        let editIndex = -1;
        let draggedItem = null;
        let username = '';
        
        // App Version
        const APP_VERSION = "1.3.3";
        
        // Caching DOM elements
        const dashboardSection = document.getElementById('dashboard-section');
        const passwordListSection = document.getElementById('password-list-section');
        const userProfileSection = document.getElementById('user-profile-section');
        const passwordListContainer = document.getElementById('password-list');
        const searchInput = document.getElementById('search-input');
        const passwordModal = document.getElementById('password-modal');
        const passwordForm = document.getElementById('password-form');
        const passwordTitleInput = document.getElementById('password-title');
        const passwordUsernameInput = document.getElementById('password-username');
        const passwordPasswordInput = document.getElementById('password-password');
        const passwordUrlInput = document.getElementById('password-url');
        const passwordNotesTextarea = document.getElementById('password-notes');
        const passwordModalTitle = document.getElementById('password-modal-title');
        const totalPasswordsSpan = document.getElementById('total-passwords');
        const navLinks = document.querySelectorAll('.nav-link');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const modalOkBtn = document.getElementById('modal-ok-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const pinModal = document.getElementById('pin-modal');
        const pinInput = document.getElementById('pin-input');
        const pinLockToggle = document.getElementById('pin-lock-toggle');
        const body = document.body;
        const profileModal = document.getElementById('profile-modal');
        const profileTitle = document.getElementById('profile-title');
        const profileDetailsContent = document.getElementById('profile-details-content');
        const usernameInput = document.getElementById('username-input');
        const welcomeMessageSpan = document.getElementById('welcome-message');
        const mobileWelcomeMessageSpan = document.getElementById('mobile-welcome-message');
        const appVersionSpan = document.getElementById('app-version');
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const mobileNavMenu = document.getElementById('mobile-nav-menu');
        const closeMobileNavBtn = document.getElementById('close-mobile-nav');
        const mobileNavLinks = document.querySelectorAll('#mobile-nav-menu .nav-link');
        const pinErrorMessage = document.getElementById('pin-error-message');
        const lockAppBtn = document.getElementById('lock-app-btn');
        const pinModalTitle = document.getElementById('pin-modal-title');
        const storageSizeSpan = document.getElementById('storage-size');
        const clearCacheBtn = document.getElementById('clear-cache-btn');


        // Functions for core logic
        function showMessage(title, message, showCancel = false) {
            return new Promise(resolve => {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                modalOkBtn.onclick = () => {
                    modal.classList.add('hidden');
                    resolve(true);
                };
                if (showCancel) {
                    modalCancelBtn.classList.remove('hidden');
                    modalCancelBtn.onclick = () => {
                        modal.classList.add('hidden');
                        resolve(false);
                    };
                } else {
                    modalCancelBtn.classList.add('hidden');
                }
                modal.classList.remove('hidden');
            });
        }

        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');

            // Highlight active link for both desktop and mobile nav
            const allNavLinks = document.querySelectorAll('.nav-link');
            allNavLinks.forEach(link => {
                if (link.dataset.page === pageId) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });

            // Close mobile menu if open
            mobileNavMenu.classList.remove('open');
        }

        function saveData() {
            const pin = localStorage.getItem('pin'); 
            const data = {
                passwords: passwords,
                username: username,
                pin: pin || null 
            };
            localStorage.setItem('passproData', JSON.stringify(data));
            updateStorageInfo();
        }
        
        function loadData() {
            const storedData = localStorage.getItem('passproData');
            if (storedData) {
                const data = JSON.parse(storedData);
                passwords = data.passwords || [];
                username = data.username || 'Guest';
                if (data.pin) {
                    localStorage.setItem('pin', data.pin);
                } else {
                    localStorage.removeItem('pin');
                }
            } else {
                username = 'Guest';
            }
        }
        
        function updateUI() {
            renderPasswords(passwords);
            totalPasswordsSpan.textContent = passwords.length;
            const pin = localStorage.getItem('pin');
            pinLockToggle.checked = !!pin;
            usernameInput.value = username;
            welcomeMessageSpan.textContent = `Welcome! ${username}`;
            mobileWelcomeMessageSpan.textContent = `Welcome! ${username}`;
            pinModalTitle.textContent = `Welcome back, ${username}!`;
            appVersionSpan.textContent = APP_VERSION;
            const block = pinLockToggle.nextElementSibling;
            const dot = block.nextElementSibling;
            if (pinLockToggle.checked) {
                block.classList.add('bg-orange-500');
                block.classList.remove('bg-gray-600');
                dot.classList.add('transform', 'translate-x-full');
            } else {
                block.classList.remove('bg-orange-500');
                block.classList.add('bg-gray-600');
                dot.classList.remove('transform', 'translate-x-full');
            }
            updateStorageInfo();
        }

        function updateStorageInfo() {
            let totalBytes = 0;
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                totalBytes += key.length + (localStorage.getItem(key) || '').length;
            }

            const units = ['Bytes', 'KB', 'MB', 'GB'];
            let size = totalBytes;
            let unitIndex = 0;
            while (size >= 1024 && unitIndex < units.length - 1) {
                size /= 1024;
                unitIndex++;
            }
            storageSizeSpan.textContent = `${size.toFixed(2)} ${units[unitIndex]}`;
        }


        function renderPasswords(passwordList) {
            passwordListContainer.innerHTML = '';
            passwordList.forEach((item, index) => {
                const passwordItem = document.createElement('div');
                passwordItem.className = 'password-item p-4 bg-[#2A2A2A] rounded-lg shadow-md hover:bg-[#333] transition-colors duration-200 cursor-pointer flex justify-between items-center group';
                passwordItem.draggable = true;
                passwordItem.dataset.index = index;
                passwordItem.innerHTML = `
                    <div class="flex-1 min-w-0">
                        <h4 class="text-lg font-semibold text-white truncate">${item.title}</h4>
                        <p class="text-sm text-secondary truncate">${item.username}</p>
                    </div>
                    <div class="flex space-x-2 opacity-0 md:opacity-100 md:relative group-hover:opacity-100 transition-opacity duration-200 md:group-hover:opacity-100">
                        <button class="view-btn p-2 rounded-full bg-orange-500 text-white hover:bg-orange-600 transition-colors" data-index="${index}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="edit-btn p-2 rounded-full bg-orange-500 text-white hover:bg-orange-600 transition-colors" data-index="${index}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="delete-btn p-2 rounded-full bg-red-500 text-white hover:bg-red-600 transition-colors" data-index="${index}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                `;
                passwordListContainer.appendChild(passwordItem);
            });
        }
        
        function validatePin() {
            const enteredPin = pinInput.value;
            const storedPin = localStorage.getItem('pin');
            
            if (enteredPin === storedPin) {
                pinModal.classList.add('hidden');
                pinErrorMessage.classList.add('hidden');
                showMessage('Success', 'PIN is correct. Welcome back!');
                pinInput.value = '';
                showPage('dashboard-section');
            } else {
                pinErrorMessage.classList.remove('hidden');
                pinInput.value = '';
            }
        }

        // Event Listeners
        document.getElementById('add-password-btn').addEventListener('click', () => {
            isEditing = false;
            passwordModalTitle.textContent = 'Add Password';
            passwordForm.reset();
            passwordModal.classList.remove('hidden');
        });

        document.getElementById('go-to-add-password').addEventListener('click', () => {
            isEditing = false;
            passwordModalTitle.textContent = 'Add Password';
            passwordForm.reset();
            passwordModal.classList.remove('hidden');
        });

        document.getElementById('go-to-passwords').addEventListener('click', () => {
            showPage('password-list-section');
        });
        
        document.getElementById('lock-app-btn').addEventListener('click', () => {
            const pin = localStorage.getItem('pin');
            if (pin) {
                pinModal.classList.remove('hidden');
                showPage('dashboard-section');
            } else {
                showMessage('PIN Lock Disabled', 'Please enable PIN Lock in Settings to use this feature.');
            }
        });

        document.getElementById('password-modal-cancel').addEventListener('click', () => {
            passwordModal.classList.add('hidden');
        });
        
        passwordForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const newPassword = {
                title: passwordTitleInput.value,
                username: passwordUsernameInput.value,
                password: passwordPasswordInput.value,
                url: passwordUrlInput.value,
                notes: passwordNotesTextarea.value,
            };
            
            if (isEditing) {
                passwords[editIndex] = newPassword;
                isEditing = false;
            } else {
                passwords.push(newPassword);
            }
            
            saveData();
            updateUI();
            passwordModal.classList.add('hidden');
        });
        
        passwordListContainer.addEventListener('click', (e) => {
            if (e.target.closest('.delete-btn')) {
                const index = e.target.closest('.delete-btn').dataset.index;
                showMessage('Delete Password', 'Are you sure you want to delete this password?', true).then(result => {
                    if (result) {
                        passwords.splice(index, 1);
                        saveData();
                        updateUI();
                        showMessage('Success', 'Password deleted successfully.');
                    }
                });
            } else if (e.target.closest('.edit-btn')) {
                const index = e.target.closest('.edit-btn').dataset.index;
                isEditing = true;
                editIndex = index;
                const item = passwords[index];
                passwordModalTitle.textContent = 'Edit Password';
                passwordTitleInput.value = item.title;
                passwordUsernameInput.value = item.username;
                passwordPasswordInput.value = item.password;
                passwordUrlInput.value = item.url;
                passwordNotesTextarea.value = item.notes;
                passwordModal.classList.remove('hidden');
            } else if (e.target.closest('.view-btn')) {
                const index = e.target.closest('.view-btn').dataset.index;
                const item = passwords[index];
                profileTitle.textContent = item.title;
                
                const urlHtml = item.url ? `<a href="${item.url}" target="_blank" class="text-orange-400 password-url-link break-words">${item.url}</a>` : 'N/A';
                
                profileDetailsContent.innerHTML = `
                    <p><strong class="text-orange-500">Username:</strong> ${item.username}</p>
                    <p><strong class="text-orange-500">Password:</strong> <span id="displayed-password">${item.password}</span></p>
                    <p><strong class="text-orange-500">URL:</strong> ${urlHtml}</p>
                    <p><strong class="text-orange-500">Notes:</strong> ${item.notes || 'N/A'}</p>
                    <button id="copy-password" class="mt-4 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">Copy Password</button>
                `;
                document.getElementById('copy-password').addEventListener('click', () => {
                    const passwordText = document.getElementById('displayed-password').textContent;
                    const tempInput = document.createElement('textarea');
                    tempInput.value = passwordText;
                    document.body.appendChild(tempInput);
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                    showMessage('Success', 'Password copied to clipboard!');
                });
                profileModal.classList.remove('hidden');
            }
        });

        document.getElementById('profile-modal-close').addEventListener('click', () => {
            profileModal.classList.add('hidden');
        });
        
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredPasswords = passwords.filter(item => 
                item.title.toLowerCase().includes(searchTerm) ||
                item.username.toLowerCase().includes(searchTerm)
            );
            renderPasswords(filteredPasswords);
        });

        document.getElementById('download-account-btn').addEventListener('click', () => {
            const dataToDownload = {
                passwords: passwords,
                username: username,
                pin: localStorage.getItem('pin') || null
            };

            const dataStr = JSON.stringify(dataToDownload, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'local-save1999.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showMessage('Success', 'Account data downloaded successfully!');
        });
        
        document.getElementById('import-file-input').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = async (event) => {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        if (importedData.passwords && importedData.username !== undefined) {
                            const result = await showMessage('Import Account', 'Importing will overwrite your current data. Are you sure?', true);
                            if (result) {
                                passwords = importedData.passwords;
                                username = importedData.username;
                                if (importedData.pin) {
                                    localStorage.setItem('pin', importedData.pin);
                                    pinLockToggle.checked = true;
                                } else {
                                    localStorage.removeItem('pin');
                                    pinLockToggle.checked = false;
                                }
                                saveData();
                                updateUI();
                                showMessage('Success', 'Account data imported successfully!');
                            }
                        } else {
                            showMessage('Error', 'Invalid file format. Please import a valid PassPro account file.');
                        }
                    } catch (error) {
                        showMessage('Error', 'Failed to parse file. Please ensure it is a valid JSON file.');
                    }
                };
                reader.readAsText(file);
            }
        });
        
        document.getElementById('arrange-btn').addEventListener('click', () => {
            arrangeMode = !arrangeMode;
            const passwords = document.querySelectorAll('.password-item');
            if (arrangeMode) {
                document.getElementById('arrange-btn').textContent = 'Done';
                passwords.forEach(item => item.style.cursor = 'grab');
            } else {
                document.getElementById('arrange-btn').textContent = 'Arrange';
                passwords.forEach(item => item.style.cursor = 'pointer');
                saveData();
            }
        });

        // Drag and Drop Logic
        passwordListContainer.addEventListener('dragstart', (e) => {
            if (arrangeMode && e.target.classList.contains('password-item')) {
                draggedItem = e.target;
                e.dataTransfer.effectAllowed = 'move';
                setTimeout(() => draggedItem.classList.add('dragging'), 0);
            }
        });

        passwordListContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
            if (arrangeMode && e.target.closest('.password-item') && e.target.closest('.password-item') !== draggedItem) {
                const dragOverItem = e.target.closest('.password-item');
                const bounding = dragOverItem.getBoundingClientRect();
                const offset = bounding.y + bounding.height / 2;
                if (e.clientY > offset) {
                    dragOverItem.style.borderBottom = '2px solid orange';
                    dragOverItem.style.borderTop = '';
                } else {
                    dragOverItem.style.borderTop = '2px solid orange';
                    dragOverItem.style.borderBottom = '';
                }
            }
        });

        passwordListContainer.addEventListener('dragleave', (e) => {
            if (e.target.closest('.password-item')) {
                const item = e.target.closest('.password-item');
                item.style.borderTop = '';
                item.style.borderBottom = '';
            }
        });

        passwordListContainer.addEventListener('drop', (e) => {
            e.preventDefault();
            if (arrangeMode && e.target.closest('.password-item')) {
                const dragOverItem = e.target.closest('.password-item');
                const fromIndex = parseInt(draggedItem.dataset.index);
                const toIndex = parseInt(dragOverItem.dataset.index);
                
                const [movedItem] = passwords.splice(fromIndex, 1);
                passwords.splice(toIndex, 0, movedItem);
                
                renderPasswords(passwords);
                
                const item = e.target.closest('.password-item');
                item.style.borderTop = '';
                item.style.borderBottom = '';
            }
            if (draggedItem) {
                draggedItem.classList.remove('dragging');
                draggedItem = null;
            }
        });

        passwordListContainer.addEventListener('dragend', () => {
            const allItems = document.querySelectorAll('.password-item');
            allItems.forEach(item => {
                item.classList.remove('dragging');
                item.style.borderTop = '';
                item.style.borderBottom = '';
            });
            saveData();
        });
        
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(e.target.dataset.page);
            });
        });

        mobileNavLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(e.target.dataset.page);
            });
        });

        pinLockToggle.addEventListener('change', async (e) => {
            const block = pinLockToggle.nextElementSibling;
            const dot = block.nextElementSibling;
            if (e.target.checked) {
                const userPin = prompt('Enter a 4-digit PIN to secure your passwords:');
                if (userPin && userPin.length === 4 && /^\d+$/.test(userPin)) {
                    localStorage.setItem('pin', userPin);
                    showMessage('Success', 'PIN lock enabled successfully.');
                    block.classList.add('bg-orange-500');
                    block.classList.remove('bg-gray-600');
                    dot.classList.add('transform', 'translate-x-full');
                    saveData();
                } else {
                    showMessage('Error', 'Invalid PIN. Please enter a 4-digit number.');
                    pinLockToggle.checked = false;
                }
            } else {
                localStorage.removeItem('pin');
                showMessage('Success', 'PIN lock disabled.');
                block.classList.remove('bg-orange-500');
                block.classList.add('bg-gray-600');
                dot.classList.remove('transform', 'translate-x-full');
                saveData();
            }
        });

        usernameInput.addEventListener('input', () => {
            username = usernameInput.value;
            saveData();
            updateUI();
        });

        document.getElementById('pin-submit-btn').addEventListener('click', validatePin);
        document.getElementById('pin-input').addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                validatePin();
            }
        });
        
        hamburgerBtn.addEventListener('click', () => {
            mobileNavMenu.classList.add('open');
        });
        closeMobileNavBtn.addEventListener('click', () => {
            mobileNavMenu.classList.remove('open');
        });

        clearCacheBtn.addEventListener('click', async () => {
            const result = await showMessage(
                'Clear All Data',
                'This will permanently delete all passwords and settings from your device. Are you sure?',
                true
            );
            if (result) {
                localStorage.clear();
                loadData();
                updateUI();
                showMessage('Success', 'All local data has been cleared.');
                showPage('dashboard-section');
            }
        });

        loadData();
        updateUI();
        
        const pin = localStorage.getItem('pin');
        if (pin) {
            document.getElementById('pin-modal').classList.remove('hidden');
        } else {
            document.getElementById('pin-modal').classList.add('hidden');
            showPage('dashboard-section');
        }
        
    </script>
</body>
</html>
