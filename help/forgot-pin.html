<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot PIN</title>
    <link rel="icon" type="image/x-icon" href="assets/favicon.png">
    
    <!-- PWA meta tags -->
    <meta name="theme-color" content="#111"/>
    <link rel="apple-touch-icon" href="assets/favicon.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111;
            color: #ccc;
        }

        /* Cool underline effect for links */
        .cool-underline {
            position: relative;
            text-decoration: none;
        }
        .cool-underline::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -2px;
            left: 0;
            background-color: currentColor;
            transition: width 0.3s ease-out;
        }
        .cool-underline:hover::after {
            width: 100%;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen items-center justify-center p-4 dark-mode">

    <div class="max-w-xl w-full p-8 space-y-6 bg-[#222] rounded-3xl shadow-lg border border-[#333]">
        <h1 class="text-3xl font-bold text-center text-white-500">Forgot Your PIN?</h1>
        <div class="space-y-4 text-center">
            <p class="text-gray-400">
                Unfortunately, your PIN is stored locally on your device and cannot be recovered or reset by us. This is a security feature to ensure your passwords remain private.
            </p>
        </div>

        <div class="space-y-4">
            <div class="p-4 bg-[#333] rounded-2xl">
                <h2 class="text-xl font-semibold text-white mb-2">Tips to Remember Your PIN:</h2>
                <ul class="list-disc list-inside space-y-1 text-gray-400">
                    <li>Try a common number sequence you often use.</li>
                    <li>Consider important dates or years that you might use</li>
                    <li>Think about when you first set up the app and what number was on your mind.</li>
                </ul>
            </div>

            <div class="p-4 bg-[#333] rounded-2xl">
                <h2 class="text-xl font-semibold text-white mb-2">Account Recovery:</h2>
                <p class="text-gray-400">
                    If you have previously downloaded your account backup file, you can 
                    <a href="#" id="import-link" class="text-[white] cool-underline">re-import your data</a> 
                    after resetting the app. Make sure you have a Backup somewhere.
                </p>
                <input type="file" id="import-file" accept=".json" class="hidden">
                <p id="import-message" class="mt-2 text-center text-sm text-green-400 hidden"></p>
            </div>

            <div class="p-4 bg-[#333] rounded-2xl">
                <h2 class="text-xl font-semibold text-white mb-2">Reset Data:</h2>
                <p class="text-gray-400">
                    If you cannot remember your PIN, you can reset all your data by clearing your browser's site data.
                </p>
                <div class="mt-4">
                    <button id="reset-button" class="w-full px-6 py-3 bg-[#222] hover:bg-[#444] text-white font-semibold rounded-2xl transition-colors duration-200 shadow-md">
                        Clear Site Data
                    </button>
                    <p id="reset-message" class="mt-2 text-center text-sm text-yellow-400 hidden"></p>
                </div>
            </div>
        </div>

        <div class="mt-6 text-center text-white-400">
            <a href="../index.html" class="text-white-500 cool-underline">Return to Login</a>
        </div>
    </div>
    <script>
        document.getElementById('reset-button').addEventListener('click', () => {
            const messageElement = document.getElementById('reset-message');
            try {
                if (navigator.storage && navigator.storage.estimate) {
                    navigator.storage.estimate().then(estimate => {
                        console.log(`Clearing ${estimate.usage} bytes of storage...`);
                    });
                }
                localStorage.clear();
                indexedDB.deleteDatabase("firebaseLocalStorageDb");
                messageElement.textContent = "Data has been cleared. Please reload the page.";
                messageElement.classList.remove('hidden');
                setTimeout(() => {
                    location.reload();
                }, 1000);

            } catch (e) {
                messageElement.textContent = "Could not clear data. Please follow the manual instructions below.";
                messageElement.classList.remove('hidden');
            }
        });

        document.getElementById('import-link').addEventListener('click', (e) => {
            e.preventDefault();
            document.getElementById('import-file').click();
        });

        document.getElementById('import-file').addEventListener('change', (event) => {
            const file = event.target.files[0];
            const messageElement = document.getElementById('import-message');

            if (!file) {
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    // Assuming the backup file is a JSON object with keys like 'username', 'passwords', 'pin', etc.
                    for (const key in data) {
                        if (Object.prototype.hasOwnProperty.call(data, key)) {
                            localStorage.setItem(key, JSON.stringify(data[key]));
                        }
                    }
                    messageElement.textContent = "Backup file imported successfully! Please reload the page.";
                    messageElement.classList.remove('hidden', 'text-red-400');
                    messageElement.classList.add('text-green-400');
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                } catch (error) {
                    console.error("Failed to parse or import backup file:", error);
                    messageElement.textContent = "Invalid backup file. Please try again.";
                    messageElement.classList.remove('hidden', 'text-green-400');
                    messageElement.classList.add('text-red-400');
                }
            };
            reader.readAsText(file);
        });
    </script>
</body>
</html>
